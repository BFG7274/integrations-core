version: '3'

services:
  voltdb0:
    image: ${VOLTDB_IMAGE}
    container_name: voltdb0
    environment:
      - HOST_COUNT=3
      - HOSTS=voltdb0,voltdb1,voltdb2
      - TLS_ENABLED=${TLS_ENABLED}
    volumes:
      - ${VOLTDB_DEPLOYMENT}:/tmp/deployment.xml
      - ./log4j.xml:/opt/voltdb/voltdb/log4j.xml
      - ./entrypoint.sh:/tmp/entrypoint.sh
      - ./localcert.properties:${TLS_CONTAINER_LOCALCERT_PATH}
      - ${TLS_OUTPUT_DIR}:/tmp/tlsoutput
    entrypoint: ["sh", "/tmp/entrypoint.sh"]
    ports:
      - ${VOLTDB_CLIENT_PORT}:${VOLTDB_CLIENT_PORT}  # JSON Interface: https://docs.voltdb.com/UsingVoltDB/ProgLangJson.php

  voltdb1:
    image: ${VOLTDB_IMAGE}
    container_name: voltdb1
    environment:
      - HOST_COUNT=3
      - HOSTS=voltdb0,voltdb1,voltdb2
      - TLS_ENABLED=${TLS_ENABLED}
    volumes:
      - ${VOLTDB_DEPLOYMENT}:/tmp/deployment.xml
      - ./log4j.xml:/opt/voltdb/voltdb/log4j.xml
      - ./entrypoint.sh:/tmp/entrypoint.sh
    entrypoint: ["sh", "/tmp/entrypoint.sh"]

  voltdb2:
    image: ${VOLTDB_IMAGE}
    container_name: voltdb2
    environment:
      - HOST_COUNT=3
      - HOSTS=voltdb0,voltdb1,voltdb2
      - TLS_ENABLED=${TLS_ENABLED}
    volumes:
      - ${VOLTDB_DEPLOYMENT}:/tmp/deployment.xml
      - ./log4j.xml:/opt/voltdb/voltdb/log4j.xml
      - ./entrypoint.sh:/tmp/entrypoint.sh
    entrypoint: ["sh", "/tmp/entrypoint.sh"]
