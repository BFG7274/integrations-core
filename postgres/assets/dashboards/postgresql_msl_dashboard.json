{
  "title": "Postgres - Overview",
  "description": "This dashboard provides a high-level overview of your PostgreSQL databases, so you can track throughput, replication, locks, and other metrics from all your servers and spot potential issues. Further reading on PostgreSQL monitoring:\n\n- [Datadog's guide to key PostgreSQL metrics](https://www.datadoghq.com/blog/postgresql-monitoring/)\n\n- [Collecting metrics with PostgreSQL monitoring tools](https://www.datadoghq.com/blog/postgresql-monitoring-tools/)\n\n- [How to monitor PostgreSQL with Datadog](https://www.datadoghq.com/blog/collect-postgresql-data-with-datadog/)\n\n- [Datadog's PostgreSQL integration docs](https://docs.datadoghq.com/integrations/postgres/)\n\nClone this template dashboard to make changes and add your own graph widgets.",
  "widgets": [
    {
      "id": 0,
      "definition": {
        "type": "note",
        "content": "![PostgreSQL](https://p-qkfgo2.t2.n0.cdn.getcloudapp.com/items/mXu5z2wp/8cba4404-3e98-4764-9bcd-ae4448920c0b.png)\n\nThis dashboard provides a high-level overview of your PostgreSQL databases, so you can track throughput, replication, locks, and other metrics from all your servers and spot potential issues. \n\nFurther reading on PostgreSQL monitoring:\n\n- [Datadog's guide to key PostgreSQL metrics](https://www.datadoghq.com/blog/postgresql-monitoring/)\n\n- [Collecting metrics with PostgreSQL monitoring tools](https://www.datadoghq.com/blog/postgresql-monitoring-tools/)\n\n- [How to monitor PostgreSQL with Datadog](https://www.datadoghq.com/blog/collect-postgresql-data-with-datadog/)\n\n- [Datadog's PostgreSQL integration docs](https://docs.datadoghq.com/integrations/postgres/)\n\nYou can clone this dashboard, copy and paste widgets from other out-of-the-box dashboards, and create your own visualizations for your custom applications.\n",
        "background_color": "white",
        "font_size": "14",
        "text_align": "left",
        "show_tick": false,
        "tick_pos": "50%",
        "tick_edge": "left"
      },
      "layout": { "x": 0, "y": 0, "width": 4, "height": 5 }
    },
    {
      "id": 1,
      "definition": {
        "title": "Basic Activity Monitor",
        "reflow_type": "fixed",
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 11,
            "definition": {
              "title": "Rows fetched / returned",
              "title_size": "16",
              "title_align": "left",
              "type": "query_value",
              "requests": [
                {
                  "q": "sum:postgresql.rows_fetched{*}/(sum:postgresql.rows_fetched{*}+sum:postgresql.rows_returned{*})*100",
                  "aggregator": "avg"
                }
              ],
              "autoscale": true,
              "custom_unit": "%",
              "precision": 1
            },
            "layout": { "x": 0, "y": 0, "width": 2, "height": 2 }
          },
          {
            "id": 12,
            "definition": {
              "title": "Max connections in use",
              "title_size": "16",
              "title_align": "left",
              "type": "query_value",
              "requests": [
                {
                  "q": "max:postgresql.percent_usage_connections{*}*100",
                  "aggregator": "last",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "palette": "black_on_light_red",
                      "value": 75
                    },
                    {
                      "comparator": ">",
                      "palette": "black_on_light_yellow",
                      "value": 50
                    },
                    {
                      "comparator": "<=",
                      "palette": "black_on_light_green",
                      "value": 50
                    }
                  ]
                }
              ],
              "autoscale": true,
              "custom_unit": "%",
              "text_align": "center",
              "precision": 0
            },
            "layout": { "x": 2, "y": 0, "width": 2, "height": 2 }
          },
          {
            "id": 13,
            "definition": {
              "title": "Connections per database",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_size": "0",
              "type": "timeseries",
              "requests": [
                {
                  "q": "avg:postgresql.connections{*} by {db}.rollup(max)",
                  "style": { "palette": "cool" },
                  "display_type": "line"
                },
                {
                  "q": "min:postgresql.max_connections{*} by {db}",
                  "style": { "palette": "warm" },
                  "display_type": "line"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "label": "",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "markers": []
            },
            "layout": { "x": 4, "y": 0, "width": 4, "height": 4 }
          },
          {
            "id": 14,
            "definition": {
              "type": "note",
              "content": "A PostgreSQL database cluster is not a collection of servers, but a collection of databases managed by a single server.",
              "background_color": "white",
              "font_size": "14",
              "text_align": "left",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "top"
            },
            "layout": { "x": 0, "y": 2, "width": 4, "height": 2 }
          }
        ]
      },
      "layout": { "x": 4, "y": 0, "width": 8, "height": 5 }
    },
    {
      "id": 2,
      "definition": {
        "title": "Resource Utilization",
        "reflow_type": "fixed",
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 21,
            "definition": {
              "title": "Tables with most disk usage (top 5)",
              "title_size": "16",
              "title_align": "left",
              "type": "toplist",
              "requests": [
                {
                  "q": "top(avg:postgresql.total_size{$scope} by {table}, 5, 'mean', 'desc')"
                }
              ]
            },
            "layout": { "x": 0, "y": 0, "width": 3, "height": 2 }
          },
          {
            "id": 22,
            "definition": {
              "title": "Tables with most live rows (1)",
              "title_size": "16",
              "title_align": "left",
              "type": "toplist",
              "requests": [
                {
                  "q": "top(avg:postgresql.live_rows{$scope} by {table}, 5, 'mean', 'desc')"
                }
              ]
            },
            "layout": { "x": 3, "y": 0, "width": 3, "height": 2 }
          },
          {
            "id": 23,
            "definition": {
              "title": "Dead rows (1)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_size": "0",
              "type": "timeseries",
              "requests": [
                {
                  "q": "sum:postgresql.dead_rows{$scope}",
                  "style": { "palette": "grey" },
                  "display_type": "line"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "label": "",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "markers": []
            },
            "layout": { "x": 6, "y": 0, "width": 6, "height": 2 }
          },
          {
            "id": 24,
            "definition": {
              "title": "Most frequently scanned indexes (1)",
              "title_size": "16",
              "title_align": "left",
              "type": "toplist",
              "requests": [
                {
                  "q": "top(avg:postgresql.index_scans{$scope} by {index}, 5, 'mean', 'desc')"
                }
              ]
            },
            "layout": { "x": 0, "y": 2, "width": 3, "height": 2 }
          },
          {
            "id": 25,
            "definition": {
              "title": "Least frequently scanned indexes (1)",
              "title_size": "16",
              "title_align": "left",
              "type": "toplist",
              "requests": [
                {
                  "q": "top(avg:postgresql.index_scans{$scope} by {index}, 5, 'mean', 'asc')"
                }
              ]
            },
            "layout": { "x": 3, "y": 2, "width": 3, "height": 2 }
          },
          {
            "id": 26,
            "definition": {
              "title": "Temp bytes",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_size": "0",
              "type": "timeseries",
              "requests": [
                {
                  "q": "sum:postgresql.temp_bytes{$scope}",
                  "style": { "palette": "purple" },
                  "display_type": "line"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "label": "",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "markers": []
            },
            "layout": { "x": 6, "y": 2, "width": 6, "height": 2 }
          },
          {
            "id": 27,
            "definition": {
              "type": "note",
              "content": "(1) Requires [relations parameter](https://docs.datadoghq.com/integrations/postgres/#metric-collection) setting in postgres yaml file.",
              "background_color": "white",
              "font_size": "14",
              "text_align": "left",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "right"
            },
            "layout": { "x": 0, "y": 4, "width": 6, "height": 1 }
          }
        ]
      }
    },
    {
      "id": 3,
      "definition": {
        "title": "Throughput",
        "reflow_type": "fixed",
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 31,
            "definition": {
              "title": "Sequential scans vs index scans (1)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_size": "0",
              "type": "timeseries",
              "requests": [
                {
                  "q": "sum:postgresql.index_scans{$scope}, sum:postgresql.seq_scans{$scope}",
                  "style": { "palette": "green" },
                  "display_type": "line"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "label": "",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "markers": []
            },
            "layout": { "x": 0, "y": 0, "width": 4, "height": 2 }
          },
          {
            "id": 32,
            "definition": {
              "title": "Rows updated / deleted / inserted (1)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_size": "0",
              "type": "timeseries",
              "requests": [
                {
                  "q": "sum:postgresql.rows_updated{$scope}, sum:postgresql.rows_deleted{$scope}, sum:postgresql.rows_inserted{$scope}",
                  "style": { "palette": "purple" },
                  "display_type": "line"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "label": "",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "markers": []
            },
            "layout": { "x": 4, "y": 0, "width": 4, "height": 2 }
          },
          {
            "id": 33,
            "definition": {
              "title": "Sequential scans (green) vs. week before (gray) (1)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_size": "0",
              "type": "timeseries",
              "requests": [
                {
                  "q": "sum:postgresql.seq_scans{$scope}",
                  "style": { "palette": "green" },
                  "display_type": "line"
                },
                {
                  "q": "week_before(sum:postgresql.seq_scans{$scope})",
                  "style": { "palette": "grey", "line_type": "dashed" },
                  "display_type": "line"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "label": "",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "markers": []
            },
            "layout": { "x": 0, "y": 2, "width": 4, "height": 2 }
          },
          {
            "id": 34,
            "definition": {
              "title": "Heap-only updates (1)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_size": "0",
              "type": "timeseries",
              "requests": [
                {
                  "q": "sum:postgresql.rows_hot_updated{$scope}",
                  "style": { "palette": "purple" },
                  "display_type": "line"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "label": "",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "markers": []
            },
            "layout": { "x": 4, "y": 2, "width": 4, "height": 2 }
          },
          {
            "id": 35,
            "definition": {
              "title": "Top function calls",
              "title_size": "16",
              "title_align": "left",
              "type": "toplist",
              "requests": [
                {
                  "q": "top(avg:postgresql.function.calls{$scope} by {function}, 5, 'mean', 'desc')"
                }
              ]
            },
            "layout": { "x": 0, "y": 4, "width": 8, "height": 2 }
          }
        ]
      },
      "layout": { "x": 0, "y": 0, "width": 8, "height": 7 }
    },
    {
      "id": 4,
      "definition": {
        "title": "",
        "title_size": "16",
        "title_align": "left",
        "type": "log_stream",
        "indexes": [],
        "query": "source:postgresql",
        "sort": { "column": "time", "order": "desc" },
        "columns": ["core_host", "core_service"],
        "show_date_column": true,
        "show_message_column": true,
        "message_display": "expanded-md"
      },
      "layout": { "x": 8, "y": 0, "width": 4, "height": 7 }
    },
    {
      "id": 5,
      "definition": {
        "title": "Locks",
        "reflow_type": "fixed",
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 51,
            "definition": {
              "title": "Locks by lock mode",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_size": "0",
              "type": "timeseries",
              "requests": [
                {
                  "q": "top(sum:postgresql.locks{$scope} by {lock_mode,table}, 5, 'mean', 'desc')",
                  "style": { "palette": "warm" },
                  "display_type": "bars"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "label": "",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "markers": []
            },
            "layout": { "x": 0, "y": 0, "width": 4, "height": 2 }
          },
          {
            "id": 52,
            "definition": {
              "title": "Deadlocks per database",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_size": "0",
              "type": "timeseries",
              "requests": [
                {
                  "q": "sum:postgresql.deadlocks{$scope}",
                  "style": { "palette": "warm" },
                  "display_type": "bars"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "label": "",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "markers": []
            },
            "layout": { "x": 0, "y": 2, "width": 4, "height": 2 }
          }
        ]
      },
      "layout": { "x": 0, "y": 0, "width": 4, "height": 5 }
    },
    {
      "id": 6,
      "definition": {
        "title": "Replication",
        "reflow_type": "fixed",
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 61,
            "definition": {
              "title": "Number of hosts with replication delay (Available in version 9.1+)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_size": "0",
              "type": "timeseries",
              "requests": [
                {
                  "q": "count_nonzero(sum:postgresql.replication_delay_bytes{$scope} by {host})",
                  "style": { "palette": "orange" },
                  "display_type": "bars"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "label": "",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "markers": []
            },
            "layout": { "x": 0, "y": 0, "width": 4, "height": 2 }
          },
          {
            "id": 62,
            "definition": {
              "title": "Max replication delay (Available in version 9.2+)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_size": "0",
              "type": "timeseries",
              "requests": [
                {
                  "q": "max:postgresql.replication_delay{$scope}",
                  "style": { "palette": "orange" },
                  "display_type": "line"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "label": "",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "markers": []
            },
            "layout": { "x": 0, "y": 2, "width": 4, "height": 2 }
          }
        ]
      },
      "layout": { "x": 4, "y": 0, "width": 4, "height": 5 }
    },
    {
      "id": 7,
      "definition": {
        "title": "Checkpoints",
        "reflow_type": "fixed",
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 71,
            "definition": {
              "title": "Scheduled (purple) vs requested (orange) checkpoints",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_size": "0",
              "type": "timeseries",
              "requests": [
                {
                  "q": "sum:postgresql.bgwriter.checkpoints_timed{$scope}.as_count(), sum:postgresql.bgwriter.checkpoints_requested{$scope}.as_count()",
                  "style": { "palette": "purple" },
                  "display_type": "bars"
                },
                {
                  "q": "sum:postgresql.bgwriter.checkpoints_requested{$scope}.as_count()",
                  "style": { "palette": "orange" },
                  "display_type": "bars"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "label": "",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "markers": []
            },
            "layout": { "x": 0, "y": 0, "width": 4, "height": 2 }
          }
        ]
      },
      "layout": { "x": 8, "y": 0, "width": 4, "height": 3 }
    }
  ],
  "template_variables": [{ "name": "scope", "default": "*" }],
  "layout_type": "ordered",
  "is_read_only": true,
  "notify_list": [],
  "reflow_type": "fixed",
  "id": "nf2-7jj-nbn"
}
